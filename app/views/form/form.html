<!DOCTYPE html>
<html>
  <head>
    <title></title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

    <style type="text/css">
        body {
          padding: 50px;
          font: 14px "Lucida Grande", Helvetica, Arial, sans-serif;
        }

        a {
          color: #00B7FF;
        }

        #form > input {
          display: block;
        }

        .block {
          display: block;
        }

        .field {
          width: 100%;
          height: 30px;
          margin-top: 10px;
          margin-bottom: 10px;
        }

        .add-special {
          float: left;
        }

        input[type=submit] {
          margin-top: 60px;
          width: 20em;  
          height: 4em;
        }

        .special-item {
          border: 2px solid black;
          border-radius: 5px;
          padding: 30px;
          margin-top: 15px;
        }

        .special-list {
          list-style-type: none;
        }

        .delete {
          position: relative;
          top: 20px;
          color: red;
          margin-left: 90%;
        }

        .delete-special {
          margin-left: 85%;
        }

    </style>
  </head>
  <body>
    <h3>Location</h3>
    <form name="form" id="form">
      <input type="text" name="name" placeHolder="Location Name" class="field location location-name" required>
      <input type="text" name="address" placeHolder="Location Address" class="field location location-address" required>
      <input type="text" name="phoneNumber" placeHolder="Location Phone Number" class="field location location-phone" required>
      <input type="text" name="website" placeHolder="Location Website" class="field location location-website"><br>
      <h3>Deal Day</h3>
      <ul class="special deal-day-list">
        <li class="special special-item js-deal-day">
          <label for="day" class="block">Day of Week</label>
          <span>Sunday</span><input type="checkbox" class="day-of-week" name="sunday" value="1"><span>:::</span>
          <span>Monday</span><input type="checkbox" class="day-of-week" name="monday" value="2"><span>:::</span>
          <span>Tuesday</span><input type="checkbox" class="day-of-week" name="tuesday" value="3"><span>:::</span>
          <span>Wednesday</span><input type="checkbox" class="day-of-week" name="wednesday" value="4"><span>:::</span>
          <span>Thursday</span><input type="checkbox" class="day-of-week" name="thursday" value="5"><span>:::</span>
          <span>Friday</span><input type="checkbox" class="day-of-week" name="friday" value="6"><span>:::</span>
          <span>Saturday</span><input type="checkbox" class="day-of-week" name="saturday" value="7"><span>:::</span>
          <label for="type" class="field special">Deal Day Type </label>
          <select name="type" class="deal-day-type" required>
            <option>--------</option>
            <option value="0">Alcohol</option>
            <option value="1">Food</option>
            <option value="2">Both</option>
          </select>
          <ul class="special special-list">
          <h3>Specials</h3>
            <li class="special special-item js-special">
            <label for="specialType" class="field special">Special Type </label>
            <select name="specialType" class="field special special-type" required>
                <option>--------</option>
                <option value="0">Alcohol</option>
                <option value="1">Food</option>
            </select>
              <input type="text" name="specialDescription" placeHolder="Special Description" class="field special js-special-description block" required>
              <label for="allDay">All day?</label>
              <select name="allDay" class="field special js-special-allDay" required>
                <option>--------</option>
                <option value="0">No</option>
                <option value="1">Yes</option>
              </select>
              <label for="startTime" class="block">Start Time</label>
              <select name="startTime" class="field special js-special-startTime block">
                <option>--------</option>
                <option value="12:00 AM">12:00 AM</option>
                <option value="11:45 PM">11:45 PM</option>
                <option value="11:30 PM">11:30 PM</option>
                <option value="11:15 PM">11:15 PM</option>
                <option value="11:00 PM">11:00 PM</option>
                <option value="10:45 PM">10:45 PM</option>
                <option value="10:30 PM">10:30 PM</option>
                <option value="10:15 PM">10:15 PM</option>
                <option value="10:00 PM">10:00 PM</option>
                <option value="9:45 PM">9:45 PM</option>
                <option value="9:30 PM">9:30 PM</option>
                <option value="9:15 PM">9:15 PM</option>
                <option value="9:00 PM">9:00 PM</option>
                <option value="8:45 PM">8:45 PM</option>
                <option value="8:30 PM">8:30 PM</option>
                <option value="8:15 PM">8:15 PM</option>
                <option value="8:00 PM">8:00 PM</option>
                <option value="7:45 PM">7:45 PM</option>
                <option value="7:30 PM">7:30 PM</option>
                <option value="7:15 PM">7:15 PM</option>
                <option value="7:00 PM">7:00 PM</option>
                <option value="6:45 PM">6:45 PM</option>
                <option value="6:30 PM">6:30 PM</option>
                <option value="6:15 PM">6:15 PM</option>
                <option value="6:00 PM">6:00 PM</option>
                <option value="5:45 PM">5:45 PM</option>
                <option value="5:30 PM">5:30 PM</option>
                <option value="5:15 PM">5:15 PM</option>
                <option value="5:00 PM">5:00 PM</option>
                <option value="4:45 PM">4:45 PM</option>
                <option value="4:30 PM">4:30 PM</option>
                <option value="4:15 PM">4:15 PM</option>
                <option value="4:00 PM">4:00 PM</option>
                <option value="3:45 PM">3:45 PM</option>
                <option value="3:30 PM">3:30 PM</option>
                <option value="3:15 PM">3:15 PM</option>
                <option value="3:00 PM">3:00 PM</option>
                <option value="2:45 PM">2:45 PM</option>
                <option value="2:30 PM">2:30 PM</option>
                <option value="2:15 PM">2:15 PM</option>
                <option value="2:00 PM">2:00 PM</option>
                <option value="1:45 PM">1:45 PM</option>
                <option value="1:30 PM">1:30 PM</option>
                <option value="1:15 PM">1:15 PM</option>
                <option value="1:00 PM">1:00 PM</option>
                <option value="12:45 PM">12:45 PM</option>
                <option value="12:30 PM">12:30 PM</option>
                <option value="12:15 PM">12:15 PM</option>
                <option value="12:00 PM">12:00 PM</option>
                <option value="11:45 AM">11:45 AM</option>
                <option value="11:30 AM">11:30 AM</option>
                <option value="11:15 AM">11:15 AM</option>
                <option value="11:00 AM">11:00 AM</option>
                <option value="10:45 AM">10:45 AM</option>
                <option value="10:30 AM">10:30 AM</option>
                <option value="10:15 AM">10:15 AM</option>
                <option value="10:00 AM">10:00 AM</option>
                <option value="9:45 AM">9:45 AM</option>
                <option value="9:30 AM">9:30 AM</option>
                <option value="9:15 AM">9:15 AM</option>
                <option value="9:00 AM">9:00 AM</option>
                <option value="8:45 AM">8:45 AM</option>
                <option value="8:30 AM">8:30 AM</option>
                <option value="8:15 AM">8:15 AM</option>
                <option value="8:00 AM">8:00 AM</option>
                <option value="7:45 AM">7:45 AM</option>
                <option value="7:30 AM">7:30 AM</option>
                <option value="7:15 AM">7:15 AM</option>
                <option value="7:00 AM">7:00 AM</option>
                <option value="6:45 AM">6:45 AM</option>
                <option value="6:30 AM">6:30 AM</option>
                <option value="6:15 AM">6:15 AM</option>
                <option value="6:00 AM">6:00 AM</option>
                <option value="5:45 AM">5:45 AM</option>
                <option value="5:30 AM">5:30 AM</option>
                <option value="5:15 AM">5:15 AM</option>
                <option value="5:00 AM">5:00 AM</option>
                <option value="4:45 AM">4:45 AM</option>
                <option value="4:30 AM">4:30 AM</option>
                <option value="4:15 AM">4:15 AM</option>
                <option value="4:00 AM">4:00 AM</option>
                <option value="3:45 AM">3:45 AM</option>
                <option value="3:30 AM">3:30 AM</option>
                <option value="3:15 AM">3:15 AM</option>
                <option value="3:00 AM">3:00 AM</option>
                <option value="2:45 AM">2:45 AM</option>
                <option value="2:30 AM">2:30 AM</option>
                <option value="2:15 AM">2:15 AM</option>
                <option value="2:00 AM">2:00 AM</option>
                <option value="1:45 AM">1:45 AM</option>
                <option value="1:30 AM">1:30 AM</option>
                <option value="1:15 AM">1:15 AM</option>
                <option value="1:00 AM">1:00 AM</option>
                <option value="12:45 AM">12:45 AM</option>
                <option value="12:30 AM">12:30 AM</option>
                <option value="12:15 AM">12:15 AM</option>
              </select>
              <label for="endTime">End Time</label>
              <select name="endTime" class="field special js-special-endTime block">
                <option>--------</option>
                <option value="12:15 AM">12:15 AM</option>
                <option value="12:00 AM">12:00 AM</option>
                <option value="11:45 PM">11:45 PM</option>
                <option value="11:30 PM">11:30 PM</option>
                <option value="11:15 PM">11:15 PM</option>
                <option value="11:00 PM">11:00 PM</option>
                <option value="10:45 PM">10:45 PM</option>
                <option value="10:30 PM">10:30 PM</option>
                <option value="10:15 PM">10:15 PM</option>
                <option value="10:00 PM">10:00 PM</option>
                <option value="9:45 PM">9:45 PM</option>
                <option value="9:30 PM">9:30 PM</option>
                <option value="9:15 PM">9:15 PM</option>
                <option value="9:00 PM">9:00 PM</option>
                <option value="8:45 PM">8:45 PM</option>
                <option value="8:30 PM">8:30 PM</option>
                <option value="8:15 PM">8:15 PM</option>
                <option value="8:00 PM">8:00 PM</option>
                <option value="7:45 PM">7:45 PM</option>
                <option value="7:30 PM">7:30 PM</option>
                <option value="7:15 PM">7:15 PM</option>
                <option value="7:00 PM">7:00 PM</option>
                <option value="6:45 PM">6:45 PM</option>
                <option value="6:30 PM">6:30 PM</option>
                <option value="6:15 PM">6:15 PM</option>
                <option value="6:00 PM">6:00 PM</option>
                <option value="5:45 PM">5:45 PM</option>
                <option value="5:30 PM">5:30 PM</option>
                <option value="5:15 PM">5:15 PM</option>
                <option value="5:00 PM">5:00 PM</option>
                <option value="4:45 PM">4:45 PM</option>
                <option value="4:30 PM">4:30 PM</option>
                <option value="4:15 PM">4:15 PM</option>
                <option value="4:00 PM">4:00 PM</option>
                <option value="3:45 PM">3:45 PM</option>
                <option value="3:30 PM">3:30 PM</option>
                <option value="3:15 PM">3:15 PM</option>
                <option value="3:00 PM">3:00 PM</option>
                <option value="2:45 PM">2:45 PM</option>
                <option value="2:30 PM">2:30 PM</option>
                <option value="2:15 PM">2:15 PM</option>
                <option value="2:00 PM">2:00 PM</option>
                <option value="1:45 PM">1:45 PM</option>
                <option value="1:30 PM">1:30 PM</option>
                <option value="1:15 PM">1:15 PM</option>
                <option value="1:00 PM">1:00 PM</option>
                <option value="12:45 PM">12:45 PM</option>
                <option value="12:30 PM">12:30 PM</option>
                <option value="12:15 PM">12:15 PM</option>
                <option value="12:00 PM">12:00 PM</option>
                <option value="11:45 AM">11:45 AM</option>
                <option value="11:30 AM">11:30 AM</option>
                <option value="11:15 AM">11:15 AM</option>
                <option value="11:00 AM">11:00 AM</option>
                <option value="10:45 AM">10:45 AM</option>
                <option value="10:30 AM">10:30 AM</option>
                <option value="10:15 AM">10:15 AM</option>
                <option value="10:00 AM">10:00 AM</option>
                <option value="9:45 AM">9:45 AM</option>
                <option value="9:30 AM">9:30 AM</option>
                <option value="9:15 AM">9:15 AM</option>
                <option value="9:00 AM">9:00 AM</option>
                <option value="8:45 AM">8:45 AM</option>
                <option value="8:30 AM">8:30 AM</option>
                <option value="8:15 AM">8:15 AM</option>
                <option value="8:00 AM">8:00 AM</option>
                <option value="7:45 AM">7:45 AM</option>
                <option value="7:30 AM">7:30 AM</option>
                <option value="7:15 AM">7:15 AM</option>
                <option value="7:00 AM">7:00 AM</option>
                <option value="6:45 AM">6:45 AM</option>
                <option value="6:30 AM">6:30 AM</option>
                <option value="6:15 AM">6:15 AM</option>
                <option value="6:00 AM">6:00 AM</option>
                <option value="5:45 AM">5:45 AM</option>
                <option value="5:30 AM">5:30 AM</option>
                <option value="5:15 AM">5:15 AM</option>
                <option value="5:00 AM">5:00 AM</option>
                <option value="4:45 AM">4:45 AM</option>
                <option value="4:30 AM">4:30 AM</option>
                <option value="4:15 AM">4:15 AM</option>
                <option value="4:00 AM">4:00 AM</option>
                <option value="3:45 AM">3:45 AM</option>
                <option value="3:30 AM">3:30 AM</option>
                <option value="3:15 AM">3:15 AM</option>
                <option value="3:00 AM">3:00 AM</option>
                <option value="2:45 AM">2:45 AM</option>
                <option value="2:30 AM">2:30 AM</option>
                <option value="2:15 AM">2:15 AM</option>
                <option value="2:00 AM">2:00 AM</option>
                <option value="1:45 AM">1:45 AM</option>
                <option value="1:30 AM">1:30 AM</option>
                <option value="1:15 AM">1:15 AM</option>
                <option value="1:00 AM">1:00 AM</option>
                <option value="12:45 AM">12:45 AM</option>
                <option value="12:30 AM">12:30 AM</option>
              </select>
            </li>
          </ul><a href="#" class="add-special">Add Special</a>
        </li>
      </ul><a href="#" class="add-day">Add Day</a>
      <input type="submit" value="Submit it Cocs!" class="submit">
    </form>
  </body>

  <script type="text/javascript">
    $(document).ready(function(){

    $('.add-special').on('click', function(e){
        console.log('first event');
        addSpecial($(this).parent().children('.special-list')[0]);
        // $('.add-special').unbind();
        e.preventDefault();
    })

    function createASpecial(isFirst) {
        var $li = $('<li class="special special-item js-special" ></li>');
        var $descriptionInput = $('<input type="text" name="specialDescription" placeHolder="Special Description" class="field special js-special-description block" required>');
        var $allDayLabel = $('<label for="allDay">All day?</label>');
        var $allDayDropDown = $($('.js-special-allDay')[0]).clone();
        var $starTimeLabel = $('<label for="startTime" class="block">Start Time</label>');
        var $startTimeDrop = $($('.js-special-startTime')[0]).clone();
        var $endTimeLabel = $('<label for="endTime">End Time</label>')[0];
        var $endTimeDrop = $($('.js-special-endTime')[0]).clone();
        var $specialTypeLabel = $('<label for="specialType" class="field special">Special Type </label>');
        var $specialType = $($('.special-type')[0]).clone();

        if (!isFirst) {
            var $exit = $('<a href="#" class="delete delete-special">Delete Special</a>');
        }

        $($li).append($descriptionInput);
        $($li).append($specialTypeLabel);
        $($li).append($specialType);
        $($li).append($allDayLabel);
        $($li).append($allDayDropDown);
        $($li).append($starTimeLabel);
        $($li).append($startTimeDrop);
        $($li).append($endTimeLabel);
        $($li).append($endTimeDrop);
        if (!isFirst) {
            $($li).append($exit);

            $exit.on('click', function(e) {
                $($li).remove();
             e.preventDefault();
            });
        }

        return $li;
    }

    function addSpecial(specialList) {
        var specialElm = $('.js-special')[0];
        $(specialList).append(createASpecial(false));
    }

    $('.add-day').on('click', function(e){

        var $li = $('<li class="special special-item js-deal-day">');
        var $label = $('<label for="day" class="block">Day of Week</label>');
        var $sunday = $('<span>Sunday</span><input type="checkbox" class="day-of-week" name="sunday" value="1"><span>:::</span>');
        var $monday = $('<span>Monday</span><input type="checkbox" class="day-of-week" name="monday" value="2"><span>:::</span>');
        var $tuesday = $('<span>Tuesday</span><input type="checkbox" class="day-of-week" name="tuesday" value="3"><span>:::</span>');
        var $wednesday = $('<span>Wednesday</span><input type="checkbox" class="day-of-week" name="wednesday" value="4"><span>:::</span>');
        var $thursday = $('<span>Thursday</span><input type="checkbox" class="day-of-week" name="thursday" value="5"><span>:::</span>');
        var $friday = $('<span>Friday</span><input type="checkbox" class="day-of-week" name="friday" value="6"><span>:::</span>');
        var $saturday = $('<span>Saturday</span><input type="checkbox" class="day-of-week" name="saturday" value="7"><span>:::</span>');
        var $specialLabel = $('<h3>Special</h3>');
        var $specialTypelabel = $('<label for="type" class="field special">Special Type </label>');
        var $specialDrop = $($('.deal-day-type')[0]).clone();
        var $specialList = $('<ul class="special special-list">');
        $($specialList).append(createASpecial(true));
        var $addSpecial = $('<a href="#" class="add-special">Add Special</a>');
        var $exit = $('<a href="#" class="delete"> Delete Day</a>');

        $($li).append($label);
        $($li).append($sunday);
        $($li).append($monday);
        $($li).append($tuesday);
        $($li).append($wednesday);
        $($li).append($thursday);
        $($li).append($friday);
        $($li).append($saturday);
        $($li).append($specialLabel);
        $($li).append($specialTypelabel);
        $($li).append($specialDrop);
        $($li).append($specialList);
        $($li).append($exit);
        $($li).append($addSpecial);
        
        var $dealDayList = $('.deal-day-list');
        $($dealDayList).append($li);

        $exit.on('click', function(e) {
            $($li).remove();
            e.preventDefault();
        });
                
        $($addSpecial).on('click', function(e) {
            addSpecial($specialList);
            e.preventDefault();
        });

        // $(specialElm).children('.add-special').on('click', function(e) {
        //   addSpecial($(this).parent().children('.special-list')[0]);
        //   e.preventDefault();
        // });
        // console.log( $(specialElm).last().children());
        // $(specialElm).last().children('delete-special').on('click', function(e) {
        //   console.log('touched');
        //   $(this).parent().remove();
        //   e.preventDefault();
        // });

        e.preventDefault();
    });

    $( '#form' ).on( 'submit', function( event ) {
        event.preventDefault();
        var dealDaysArray = [];

        var location = {
            name : $('.location-name').val(),
            address : $('.location-address').val(),
            phoneNumber : $('.location-phone').val(),
            website : $('.location-website').val(),
            dealDays : dealDaysArray
        };

        var dealDays = $('li.js-deal-day').toArray();

        $(dealDays).each(function( index ) {

            var dealDay = $(this),
                specials = [];

            var fSpecials = dealDay.children('.special-list').children('.special-item').toArray();
            var daysOfWeek = dealDay.children('.day-of-week').toArray();
            var checkedDays = [];

            for (var i = 0; i < daysOfWeek.length; i++) {
                if (daysOfWeek[i].checked) {
                    checkedDays.push($(daysOfWeek[i]).val());
                }
            }
        
            for (var k = 0; k < checkedDays.length; k++) {
                var deal = {
                    day : checkedDays[k],
                    type : dealDay.children('.deal-day-type').val(),
                    specials : specials
                };
            
                
                    console.log(fSpecials.length);
                for (var j = 0; j < fSpecials.length; j++) {
                    console.log(j);
                    var specialElm = $(fSpecials[j]);
                    
                    var special = {
                        specialDescription : specialElm.children('.js-special-description').val(),
                        specialType : specialElm.children('.special-type').val(),
                        allDay : specialElm.children('.js-special-allDay').val(),
                        startTime : specialElm.children('.js-special-startTime').val(),
                        endTime : specialElm.children('.js-special-endTime').val()
                    };
                    
                    deal.specials.push(special);
                }

                specials = [];

                dealDaysArray.push(deal);
            }
        });

        console.log(location);

        $.ajax({
                type: "POST",
                url: "/form",
                beforeSend: function(xhr) {xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'))},
                data: location,
                dataType: "json",
                success: function(data) {
                        alert('Nice job cocs! I love you!');
                        window.location.reload()
                },
                error: function(data){
                    console.log(data);
                        alert("Something went wrong cocs. Make sure all the fields are filled out. If they are and it still failed then let me know");
                }
        });
    });

});

  </script>
</html>